/*-- copyright
 * OpenProject is a project management system.
 * Copyright (C) 2012-2013 the OpenProject Foundation (OPF)
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License version 3.
 *
 * OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:
 * Copyright (C) 2006-2013 Jean-Philippe Lang
 * Copyright (C) 2010-2013 the ChiliProject Team
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 *
 * See doc/COPYRIGHT.rdoc for more details.  ++
 */

@import openproject/variables
@import helpers/functions

@mixin story-header
  background-color: #FFFFFF
  font-size: 1rem - rem-calc(5px)
  opacity: 1
  filter: alpha(opacity = 80)
  overflow: hidden
  padding-bottom: 1px
  padding-right: 3px

@mixin story-footer
  float: left
  font-size: 1rem - rem-calc(5px)
  width: 85%
  margin-top: 4px
  padding: 2px
  padding-top: 0

@mixin ellipsis
  overflow: hidden
  white-space: nowrap
  text-overflow: ellipsis


.controller-rb_taskboards.action-show #main
  overflow: visible

#rb .task
  color: #484848 !important
  line-height: inherit
  white-space: inherit

#rb
  #assigned_to_id_options
    display: none
  .swimlane
    min-width: 170px
    /* width + (2*margin) + (2*padding) + (2*border) of .work_package */
    padding: 5px 0 0 5px
    width: 170px
    /* Must be the same as min-width */
    //border-radius: 0 0 10px 10px
    //border-top: 0
  #board_header
    background-color: #EBEBEB
    border: 1px solid #CCCCCC
    margin-bottom: 0
    margin-right: 10px
    td
      background-color: #EBEBEB
      border-right: 1px dotted #CFCFCF
      color: black
      font-weight: bold
      text-align: center
      vertical-align: middle
      padding-top: 0
      padding-bottom: 0
      line-height: 30px
      &:first-child
        min-width: 241px
        width: 241px

  .board
    background-color: #FCFCFC
    border: 1px solid #CCCCCC
    border-top: none
    margin-right: 10px
    /* IE7 table fix */
    table-layout: fixed
    border-collapse: collapse
    empty-cells: show
    tr:hover
      background-color: #ffffff
    td
      border-right: 1px dotted #CFCFCF
      border-bottom: 1px dotted #CFCFCF
      vertical-align: top
      &:first-child
        min-width: 210px
        padding: 5px
        width: 210px
    tr:last-child td
      border-bottom: none
    .add_new
      margin: 0
      min-width: 30px
      padding: 0
      text-align: center
      vertical-align: middle
      width: 30px
      &.clickable:hover
        cursor: pointer
        background-color: #ffffcc
  .story, .label_sprint_impediments
    background-color: #F8F6A5
    border: none
    display: block
    float: left
    height: 80px
    margin: 5px
    padding: 5px
    position: relative
    width: 190px
  .story
    .subject
      height: 42px
      line-height: 13px
      margin-top: 0
      overflow: hidden
      padding: 2px
      width: 180px
    &.closed .subject
      text-decoration: line-through
  .work_package, .placeholder
    //border: none
    cursor: move
    display: block    
    background: #fff !important
    // float: none !important
    // width: auto !important
    // height: auto !important
    border: 1px solid #DBDBDB
    border-radius: 10px !important
    box-shadow: none !important
    color: #333 !important
    //cursor: move !important
    font-size: 14px !important
    margin-top: 5px !important
    margin-bottom: 10px !important
    padding: 10px !important
    position: relative !important
    transition: background-color 140ms ease-in-out, border-color 75ms ease-in-out !important
  .work_package.prevent_edit
    cursor: default
  .placeholder
    background-color: #FFFF00
    border: 1px dashed #333300
    height: 78px
    width: 83px
  .work_package
    &.closed .subject.editable
      text-decoration: line-through
    .v
      display: none
    .remaining_hours.editable
      border: 0 !important
      background-color: #dfe1e6 !important
      color: #172b4d !important
      font-size: 12px !important
      line-height: 16px
      padding: 3px 5px 2px 5px !important
      font-weight: 600
      color: #404040
      border-radius: 2em
      min-width: 12px
      height: auto !important
      position: initial !important
      display: inline-block
    .blocks, .remaining_hours.editable.empty
      display: none
    .indicator
      display: none

    &.saving .indicator
      background-color: #FFFFFF
      background-position: center
      background-repeat: no-repeat
      border: 2px solid #000000
      height: 16px
      padding: 2px
      position: absolute
      left: 36px
      top: 38px
      width: 16px
      background-image: image-url("loading.gif")
      display: block

    &.error .indicator
      background: none
      border: none

    &.error.icon-bug:before
      position: absolute
      top: 30px
      left: 28px
      color: red


    .editors
      display: none

/*
 *  swimlane class is used by:
 *    - #board_header
 *    - .board
 *
 *  Also use by the Column Width preference to determine the unit width of the
 *  swimlanes. See RB.Taskboard.initialize()

/* status labels */

/* shared #impediments and #tasks */

/* item styles used by .task and .impediment */

/* dialog */

.task_editor_dialog.ui-dialog
  .ui-widget-header
    background: none
    background-color: #FFFFFF
    opacity: 0.5
    filter: alpha(opacity = 50)
  .ui-dialog-title
    float: right
    margin-right: 0
    color: $body-font-color
  &.ui-widget-content
    background: none
    border: none
    .editor
      color: $body-font-color
  .ui-dialog-buttonpane.ui-widget-content
    background: none
    background-color: none
    border: none

.ui-dialog-titlebar-close
  overflow: hidden

.dark #task_editor label
  color: #FFFFFF

.light #task_editor label
  color: #000000

.dark div
  color: #FFFFFF

.light div
  color: #000000

/* item editor */

#task_editor
  label
    display: block
    font-size: 11px
    text-transform: capitalize
    width: 100%
  .editor
    font-size: 11px
    margin-bottom: 10px
    width: 100%
  .subject
    height: 65px
    width: 272px
  .remaining_hours, .blocks
    width: 268px

/* compact view */

#rb
  .compact
    .story, .label_sprint_impediments
      height: 15px
    .story .subject
      display: none
    .work_package
      height: 21px
      padding: 0
      width: 21px
      *
        display: none
    .placeholder
      background-color: #FFFF00
      border: 1px dashed #333300
      height: 19px
      width: 19px
  #impediment_template, #task_template
    display: none

/* others */

.story
  .story-bar
    @include story-header
    text-align: right
    width: 180px
    clear: both
    .id
      float: right
    .status
      float: left

.story,
.label_sprint_impediments
  font-size: 1rem - rem-calc(3px)

.work_package
  .id
    @include story-header
    text-align: left
    font-weight: 600
    //width: 75px
    //float: right
    //margin-left: 10px
    a
      opacity: 1.0
      filter: alpha(opacity = 100)
      color: #41A3F3
      font-size: 11px
      font-weight: 600
    div
      color: #41A3F3 !important
  .editable:hover
    background-color: transparent
  .subject
    font-size: 11px !important
    color: #41A3F3 !important
    font-weight: 600 !important

  .subject.editable
    font-size: 1rem - rem-calc(3px)
    margin-top: 0        
    display: block !important
    box-sizing: content-box !important
    line-height: 1.42857143 !important
    max-height: 4.28571429em !important
    overflow: hidden !important
    margin-bottom: 15px !important
    width: auto !important
    height: auto !important
    padding: 0 !important
  .date
    font-size: 10px
    line-height: 12px
    font-weight: 600
    margin-bottom: 5px
    div
      color: #C7C7C7 !important
    span
      color: #868686
      margin-right: 5px
  &.priority-low
    border-left: 3px solid #FFB354 !important
  &.priority-normal
    border-left: 3px solid #5ABE2B !important
  &.priority-high
    border-left: 3px solid #FF001D !important
.task_type, .task_priority
    display: inline-block
.story
  .story-footer
    .assigned_to_id
      @include story-footer
      @include ellipsis
    .story-points
      margin-top: 2px
      float: right
.work_package
  .assigned_to_id.editable
    width: auto !important
    display: block
    //float: right !important
    margin-top: 0 !important
    padding: 0 !important
    font-size: 10px !important
    font-weight: 600
    color: #868686
    .t
      @include ellipsis

/* Toolbar modifications (no support for labels form the component) */

#toolbar
  label[for=col_width_input]
    padding-top: rem-calc(20px)

  #col_width_input
    max-width: 60px


/* Kanban new Design */
.wp-work-wrapper
    margin-right: -32px
    #wp-work 
        display: table
        table-layout: fixed
        width: 100%
        overflow: hidden
        #wp-pool-column
            display: table-cell
            height: inherit
            vertical-align: top
            padding-right: 32px
            #wp-pool 
                //background: #fff
                overflow-y: auto
                position: relative
                z-index: 1
                box-sizing: border-box
                margin-left: -10px
                margin-right: -10px
                padding: 20px 0 0 0
                .no-data
                  margin-top: -44px
#wp-column-header-group.wp-fixed
    position: absolute
    //background: #fff
    z-index: 2
    left: 0
    top: 0
.wp-column-headers, .wp-columns 
    -moz-box-sizing: border-box
    -webkit-box-sizing: border-box
    box-sizing: border-box
    border-spacing: 11px 0
    display: table
    list-style: none
    margin: 0
    table-layout: fixed
    width: 100%
    padding: 0
.wp-column-headers .wp-column, .wp-columns .wp-column 
  background: #ffffff
  -moz-box-sizing: border-box
  -webkit-box-sizing: border-box
  box-sizing: border-box
  display: table-cell
  list-style: none
  margin: 0
  position: relative
  vertical-align: top
  padding: 10px
  border-radius: 10px
  border: 1px solid #E8E8E8
  font-size: 14px
.wp-column-headers .wp-column
  border-top: 5px solid #41A3F3
  min-width: 170px
  width: 170px
  // padding: 15px
  // border-radius: 10px 10px 0 0
  // border-bottom: 0
.wp-column
  .wp-column-header-flex
      display: flex
      flex-wrap: wrap
      .wp-column-header-flex-1
          display: flex
          max-width: 100%
  h2
    color: #404040
    font-size: 14px
    font-weight: 600
    //text-transform: uppercase
    flex: 0 100 auto
    overflow: hidden
    text-overflow: ellipsis
    white-space: nowrap
    margin: 0 5px 0 0
    word-wrap: break-word
    padding: 0
.wp-swimlane-header
  font-size: 14px
  line-height: 1.3
  color: #253858
  margin: 0 20px 0 0
  overflow: hidden
  padding-left: 13px
  position: relative
  .wp-expander
    bottom: 0
    cursor: pointer
    left: 0
    position: absolute
    top: 0
    width: 12px
  .wp-heading
    display: inline-block
    margin: 10px 0 0 !important
    max-width: 0
    vertical-align: middle
    white-space: nowrap
    width: 100% !important
    background-color: transparent !important
    height: auto !important
    padding: 0 !important
    a
      color: #41a3f3
  .wp-swimlane-avatar
    margin-right: 5px
    img
      display: inline-block
      vertical-align: text-bottom
      height: 16px
      width: 16px
      max-width: inherit
  .wp-info
    margin: 0 5px
    .aui-lozenge
      background: #fff
      border: 1px solid #c1c7d0
      border-radius: 3px
      color: #333
      display: inline-block
      font-size: 11px
      font-weight: bold
      line-height: 99%
      margin: 0
      padding: 4px 5px
      text-align: center
      text-decoration: none
      text-transform: uppercase
    .wp-description
      color: #5e6c84
      font-size: 12px
.wp-columns
  margin-top: 10px
  .wp-column
    padding: 10px 15px 5px !important
.wp-parent-group
  margin: 5px 0
  border-radius: 3px
  background: #e4e4e4
.wp-issue
  background: #fff
  border: 0
  border-radius: 2px
  box-shadow: 0px 1px 2px 0px rgba(9, 30, 66, 0.25)
  color: #333
  cursor: move
  font-size: 14px
  margin-top: 5px
  margin-bottom: 5px
  padding: 10px
  position: relative
  transition: background-color 140ms ease-in-out, border-color 75ms ease-in-out
  .wp-summary
    display: block
    box-sizing: content-box
    line-height: 1.42857143
    max-height: 4.28571429em
    overflow: hidden
    margin-bottom: 20px
  .wp-stat-fields
    display: -webkit-flex
    display: -ms-flexbox
    display: flex
    -webkit-flex-wrap: nowrap
    -ms-flex-wrap: nowrap
    flex-wrap: nowrap
    -webkit-justify-content: space-between
    -ms-flex-pack: justify
    -ms-justify-content: space-between
    justify-content: space-between
    margin-top: 0
  .wp-row
    max-width: 100%
    overflow: hidden
    text-overflow: ellipsis
    white-space: nowrap
    .wp-field
      + .wp-field
          margin-left: 5px
  .wp-field-icon
    img
      height: 16px
      width: 16px
  .wp-key
    display: flex
    min-width: 0
    line-height: 24px
    vertical-align: middle
    margin-right: 5px
    .wp-issuekey-pkey
      flex: 0 10000 auto
      overflow: hidden
      text-align: right
      text-overflow: ellipsis
    .wp-issuekey-number
      direction: rtl
      flex: 0 1 auto
      overflow: hidden
      text-overflow: ellipsis

.wp-issue .wp-stat-fields > .wp-row.wp-stat-1
  margin-right: 5px
  -webkit-flex: 1 0 auto
  -ms-flex: 1 0 auto
  flex: 1 0 auto
.wp-issue .wp-stat-fields > .wp-row.wp-stat-2
  -webkit-flex: 1 1 auto
  -ms-flex: 1 1 auto
  flex: 1 1 auto
  display: -webkit-flex
  display: -ms-flexbox
  display: flex
  -webkit-flex-direction: row-reverse
  -ms-flex-direction: row-reverse
  flex-direction: row-reverse
.wp-avatar-img
  -webkit-border-radius: 50%
  border-radius: 50%
  font-size: 24px
  height: 24px
  line-height: 24px
  width: 24px
  cursor: move
  color: #fff
  cursor: default
  display: inline-block
  text-align: center
  text-transform: uppercase
  vertical-align: middle
aui-badge
  font-size: 12px
  font-weight: 600
  line-height: 16px
  background-color: #dfe1e6
  color: #172b4d
  min-width: 12px
  border-radius: 2em
  display: inline-block
  padding: 3px 5px 2px 5px
  position: relative
  text-align: center
.story-hide
  display: none
.task-high-priority
  border-left: 3px solid #FF001D
.task-normal-priority
  border-left: 3px solid #5ABE2B
.task-low-priority
  border-left: 3px solid #FFB354